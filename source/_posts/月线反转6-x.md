---
title: 月线反转6.x
date: 2022-09-07 09:12:32
tags:
  - stock
  - rps
  - 月线反转
categories: stock
---
* 选股到上市一年以上的自定义板块
  1、首先建立一个自定义板块，板块名称为"上市一年以上"： 选择通达信的[选项]->[自定义板块设置]菜单项，新建板块确定即可。
  2、使用下面的选股公式，把一年以上的股票筛选到"上市一年以上"的板块.

    ~~~
    BARSCOUNT(C)>N; 
    --N为参数，一般设为250
    -- 选股范围为：沪深A股
    ~~~
  
  ![img](/images/stock/月线反转/上市一年以上.jpg)

​       ![img](/images/stock/月线反转/上市一年以上条件选股.jpg)

<!--more-->

* 建立一个公式，命名为“EXTRS”，用来计算股票涨跌幅。

  ~~~
  
  EXTRS:(C-REF(C,N))/REF(C,N);
  
  -- N缺省值为250。
  
  -- 通达信软件，Control+F，技术指标公式—其他类型
  ~~~

* 建立扩展数据，对股票涨跌幅排序

         ~~~     
           通达信软件输入.902，进入扩展数据管理器。 选中第1条扩展数据；
           点击上图中的修改，在扩展数据属性里首先设置数据1如下：
           技术指标公式选择新建的“EXTRS”指标
           计算参数为120（对应半年期的RPS）
           计算时段为本地所有数据
           计算品种为“自定义板块”下面的“上市一年以上”这个板块
           勾选“精确复权”及“生成横向排名数据”
           排名方法为“0-1000归一化顺序”
         
         ~~~

如下图：

​      ![img](/images/stock/月线反转/扩展数据管理器.jpg)

​      ![img](/images/stock/月线反转/扩展数据属性.png)

用同样的方法，分别设置好250、50周期的扩展数据属性。

* 建立月线反转的主图叠加技术指标   (**（必须是主图叠加）的源代码是(是用来在日K线的主图上显示黄色笑脸的月线反转图标)：**)       

  ~~~
  MA10:MA(CLOSE,10);
  
  MA20:MA(CLOSE,20);
  
  MA50:MA(CLOSE,50);
  
  MA120:MA(CLOSE,120);
  
  MA200:MA(CLOSE,200);
  
  MA250:MA(CLOSE,250);
  
  
  
  Z50:=EXTDATA_USER(3,0);{50天的}
  
  RPS50:=Z50/10;
  
  FYX11:=IF(RPS50<=87,0,1);{RPS50大于87}
  
  
  
  Z120:=EXTDATA_USER(1,0);{120天的}
  
  RPS120:=Z120/10;
  
  FYX12:=IF(RPS120<=90,0,1);{RPS120大于90}
  
  
  
  FYX130:=RPS50>=90 OR RPS120>=90;{当天RPS50或RPS120大于90，在后面被FYX32引用}
  
  FYX131:=C>=HHV(C,70);{创70日最高收盘价}
  
  FYX13:=FYX130 AND FYX131;{创70日新高，且当天RPS50或RPS120大于90。在后面被FYX21、FYX22、FYX63、FYX72等引用}
  
  
  
  FYX1:=FYX11 OR FYX12;
  
  
  
  FYX21:=LLV(L,50)>LLV(L,200) AND FYX13;{50日内最低价大于200日内最低价}
  
  FYX22:=LLV(L,30)>LLV(L,120) AND FYX13;{30日内最低价大于120日内最低价，且FYX13}
  
  FYX23:=LLV(L,20)>LLV(L,50) AND LLV(L,10)>LLV(L,20);{20日内最低价大于50日内最低价}
  
  FYX2:=FYX21 OR FYX22 OR FYX23;{结构紧凑的重要条件}
  
  
  
  NH80:=IF(H<HHV(H,80),0,1);
  
  FYX31:=COUNT(NH80,10);{10天内曾创80日新高}
  
  FYX32:=(C>=HHV(C,50) OR H>=HHV(H,50)) AND FYX130;{当天创50日最高收盘价或50日最高价，且RPS50或RPS120大于90}
  
  FYX3:=FYX31 OR FYX32;
  
  
  
  FYX4:=C>MA(C,20) AND C>MA(C,200) AND MA(C,120)/MA(C,200)>0.9;{当天收盘价必须站上20天线和200天线}
  
  
  
  NN200:=IF(C>MA(C,200),1,0);{当天收盘价大于200天线}
  
  AA200:=COUNT(NN200,45);
  
  FYX51:=AA200>2 AND AA200<45;{45天内，收盘价站上200天线的天数大于2，小于45}
  
  LNN200:=IF(L<MA(C,200),1,0);
  
  LAA200:=COUNT(LNN200,45);
  
  FYX52:=LAA200>0 AND AA200>2;{45天内，至少有一天的最低价低于200天线;且至少站上200天线3天以上}
  
  FYX5:=FYX51 OR FYX52;
  
  
  
  FYX601:=MA(C,120)>=REF(MA(C,120),15) OR MA(C,200)>=REF(MA(C,200),15);{120天线或200天线呈上升趋势}
  
  FYX602:=MA(C,120)>=REF(MA(C,120),15) AND MA(C,200)>=REF(MA(C,200),15);{120天线和200天线线呈上升趋势}
  
  FYX603:=MA(C,120)>MA(C,200) AND MA(C,200)>MA(C,250); {120日线、200日线、250日线呈多头排列}
  
  FYX61:=HHV(H,30)/LLV(L,120)<1.50 AND FYX601;{30天内最高价与120日内最低价之比小于1.5，且120天线或200天线呈上升趋势，石英股份2022年的平台在120天左右}
  
  FYX62:=HHV(H,30)/LLV(L,120)<1.60 AND FYX602;{30天内最高价与120日内最低价之比小于1.6，且120天线和200天线线呈上升趋势}
  
  FYX63:=HHV(H,30)/LLV(L,120)<1.75 AND FYX603 AND FYX13;{30天内最高价与120日内最低价之比小于1.75，且长期均线呈多头排列，且满足FYX13}
  
  FYX6:=FYX61 OR FYX62 OR FYX63;
  
  
  
  FYX71:=HHV(H,5)/HHV(H,120)>0.85;{5天内最高价距离120日内的最高价不到15%}
  
  FYX72:=HHV(H,5)/HHV(H,120)>0.8 AND FYX13;{5天内最高价距离120日内的最高价不到20%，且满足FYX13}
  
  FYX73:=C/HHV(H,10)>0.9;{当天收盘价距离10日内的最高价不到10%}
  
  FYX7:=(FYX71 OR FYX72) AND FYX73;
  
  
  
  YXFZ:=FYX1 AND FYX2 AND FYX3 AND FYX4 AND FYX5 AND FYX6 AND FYX7; 
  
  DRAWICON(BARSSINCEN(YXFZ,15)=0,LOW,34);{月线反转信号画图标34:黄色笑脸}
  
  
  ~~~

  月线反转条件选股公式：

  ~~~
  Z50:=EXTDATA_USER(3,0);{50天的}
  
  RPS50:=Z50/10;
  
  FYX11:=IF(RPS50<=87,0,1);{RPS50大于87}
  
  
  
  Z120:=EXTDATA_USER(1,0);{120天的}
  
  RPS120:=Z120/10;
  
  FYX12:=IF(RPS120<=90,0,1);{RPS120大于90}
  
  
  
  FYX130:=RPS50>=90 OR RPS120>=90;{当天RPS50或RPS120大于90，在后面被FYX32引用}
  
  FYX131:=C>=HHV(C,70);{创70日最高收盘价}
  
  FYX13:=FYX130 AND FYX131;{创70日新高，且当天RPS50或RPS120大于90。在后面被FYX21、FYX22、FYX63、FYX72等引用}
  
  
  
  FYX1:=FYX11 OR FYX12;
  
  
  
  FYX21:=LLV(L,50)>LLV(L,200) AND FYX13;{50日内最低价大于200日内最低价}
  
  FYX22:=LLV(L,30)>LLV(L,120) AND FYX13;{30日内最低价大于120日内最低价，且FYX13}
  
  FYX23:=LLV(L,20)>LLV(L,50) AND LLV(L,10)>LLV(L,20);{20日内最低价大于50日内最低价}
  
  FYX2:=FYX21 OR FYX22 OR FYX23;{结构紧凑的重要条件}
  
  
  
  NH80:=IF(H<HHV(H,80),0,1);
  
  FYX31:=COUNT(NH80,10);{10天内曾创80日新高}
  
  FYX32:=(C>=HHV(C,50) OR H>=HHV(H,50)) AND FYX130;{当天创50日最高收盘价或50日最高价，且RPS50或RPS120大于90}
  
  FYX3:=FYX31 OR FYX32;
  
  
  
  FYX4:=C>MA(C,20) AND C>MA(C,200) AND MA(C,120)/MA(C,200)>0.9;{当天收盘价必须站上20天线和200天线}
  
  
  
  NN200:=IF(C>MA(C,200),1,0);{当天收盘价大于200天线}
  
  AA200:=COUNT(NN200,45);
  
  FYX51:=AA200>2 AND AA200<45;{45天内，收盘价站上200天线的天数大于2，小于45}
  
  LNN200:=IF(L<MA(C,200),1,0);
  
  LAA200:=COUNT(LNN200,45);
  
  FYX52:=LAA200>0 AND AA200>2;{45天内，至少有一天的最低价低于200天线;且至少站上200天线3天以上}
  
  FYX5:=FYX51 OR FYX52;
  
  
  
  FYX601:=MA(C,120)>=REF(MA(C,120),15) OR MA(C,200)>=REF(MA(C,200),15);{120天线或200天线呈上升趋势}
  
  FYX602:=MA(C,120)>=REF(MA(C,120),15) AND MA(C,200)>=REF(MA(C,200),15);{120天线和200天线线呈上升趋势}
  
  FYX603:=MA(C,120)>MA(C,200) AND MA(C,200)>MA(C,250); {120日线、200日线、250日线呈多头排列}
  
  FYX61:=HHV(H,30)/LLV(L,120)<1.50 AND FYX601;{30天内最高价与120日内最低价之比小于1.5，且120天线或200天线呈上升趋势，石英股份2022年的平台在120天左右}
  
  FYX62:=HHV(H,30)/LLV(L,120)<1.60 AND FYX602;{30天内最高价与120日内最低价之比小于1.6，且120天线和200天线线呈上升趋势}
  
  FYX63:=HHV(H,30)/LLV(L,120)<1.75 AND FYX603 AND FYX13;{30天内最高价与120日内最低价之比小于1.75，且长期均线呈多头排列，且满足FYX13}
  
  FYX6:=FYX61 OR FYX62 OR FYX63;
  
  
  
  FYX71:=HHV(H,5)/HHV(H,120)>0.85;{5天内最高价距离120日内的最高价不到15%}
  
  FYX72:=HHV(H,5)/HHV(H,120)>0.8 AND FYX13;{5天内最高价距离120日内的最高价不到20%，且满足FYX13}
  
  FYX73:=C/HHV(H,10)>0.9;{当天收盘价距离10日内的最高价不到10%}
  
  FYX7:=(FYX71 OR FYX72) AND FYX73;
  
  
  
  YXFZ:=FYX1 AND FYX2 AND FYX3 AND FYX4 AND FYX5 AND FYX6 AND FYX7; 
  
  BARSSINCEN(YXFZ,15)=0;
  ~~~

  ![img](/images/stock/月线反转/月线反转条件选股.png)

* 下载几个数据

  * 上市一年以上的板块可以每季度更新

  * 基金持股3%和北向资金持股3000万的板块可以每季度选股更新一次

  * 盘后数据和财务数据每天盘后下载

  * 扩展数据每天都更新

    

* 选股步骤

  * 首先从上市一年板块中使用（基金持股3% or 北向资金3000万）的条件，选股到【基金加北向】板块

  * 从基金加北向的板块中使用月线反转的条件，选股到月线反转板块。时间跨度为一个季度，如下图：

  ![img](/images/stock/月线反转/月线反转条件选股.png) 

    

 





